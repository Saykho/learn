# Сетевая шпаргалка: OSI, HTTP/HTTPS, кэширование и ограничения

## Модель OSI (7 уровней)

| Уровень | Название | Примеры протоколов | Основная функция |
|----------|-----------|--------------------|------------------|
| 7 | **Прикладной (Application)** | HTTP, HTTPS, FTP, DNS | Взаимодействие с приложениями |
| 6 | **Представительный (Presentation)** | SSL/TLS, MIME, JPEG | Кодирование, сжатие, шифрование |
| 5 | **Сеансовый (Session)** | RPC, NetBIOS | Управление сеансами и соединениями |
| 4 | **Транспортный (Transport)** | TCP, UDP | Надёжная доставка данных |
| 3 | **Сетевой (Network)** | IP, ICMP | Адресация и маршрутизация |
| 2 | **Канальный (Data Link)** | Ethernet, Wi-Fi (802.11) | Передача кадров между узлами |
| 1 | **Физический (Physical)** | Кабель, оптика, радиосигнал | Передача битов |

- HTTP/HTTPS → **уровень 7 (прикладной)**
- TCP/UDP → **уровень 4 (транспортный)**
- IP → **уровень 3 (сетевой)**

## Как работает HTTP
**HTTP (HyperText Transfer Protocol)** — текстовый протокол уровня приложений.  
Работает поверх **TCP**, обычно на порту **80**.
### Принцип:
1. Клиент открывает TCP-соединение с сервером
2. Отправляет **запрос** (`Request Line + Headers + Body`)
3. Сервер отвечает **ответом** (`Status Line + Headers + Body`)
4. Соединение закрывается (или переиспользуется при keep-alive)

### Пример запроса
```
GET /index.html HTTP/1.1
Host: example.com
Accept: text/html
```

### Пример ответа
```
HTTP/1.1 200 OK
Content-Type: text/html
Cache-Control: max-age=3600
```

## Как работает HTTPS
**HTTPS = HTTP + TLS (шифрование)**  
Работает обычно на порту **443**.

### Процесс:
1. Клиент соединяется с сервером по TCP:443
2. Идёт **TLS handshake** — проверка сертификата и обмен ключами
3. После установления защищённого канала — идёт обычный HTTP-трафик (но зашифрованный)

### Разница с HTTP:
| Параметр | HTTP | HTTPS |
|-----------|-------|--------|
| Безопасность | нет | шифрование (TLS) |
| Порт | 80 | 443 |
| Целостность данных | нет | да |
| Подлинность сервера | нет | да (через сертификат) |

## Ограничения HTTP / HTTPS
| Тип ограничения | Где задаётся | Пример |
|------------------|--------------|--------|
| **Макс. размер заголовков** | сервер или прокси | Nginx: `large_client_header_buffers` |
| **Макс. размер тела запроса** | сервер | Nginx: `client_max_body_size` |
| **Макс. строка запроса (URI)** | веб-сервер | Apache: `LimitRequestLine`, Nginx: `large_client_header_buffers` |
| **Количество открытых соединений** | клиент/сервер/браузер | например, 6 на домен в браузере |
| **Таймауты** | сервер и клиент | Nginx: `client_body_timeout`, `keepalive_timeout` |

*Эти ограничения определяются веб-сервером (Nginx, Apache, Node.js HTTP Server и т.п.), а не самим протоколом HTTP.*

## Кэширование HTTP
### Как работает
HTTP позволяет кэшировать ответы, чтобы не запрашивать сервер повторно.  
Кэш могут хранить: браузер, CDN, прокси или сам сервер.

### Основные заголовки

| Заголовок | Описание |
|------------|-----------|
| **Cache-Control** | Основной механизм управления кэшем (`max-age`, `no-cache`, `public`, `private`) |
| **ETag** | Уникальный идентификатор версии ресурса |
| **Last-Modified** | Дата последнего изменения |
| **Expires** | Устаревший способ, задаёт время истечения |
| **Vary** | Определяет, от каких заголовков зависит кэш (например, `Accept-Language`) |

### Пример
```
Cache-Control: public, max-age=3600
ETag: "abc123"
```
### Процесс кэширования
1. Клиент делает запрос
2. Сервер отвечает с кэш-заголовками
3. При повторном запросе браузер проверяет:
    - Если ресурс не изменился → отдаётся из кэша
    - Если изменился → делается запрос с `If-None-Match` (проверка ETag)

## Где настраивается кэш

| Место | Пример настройки |
|--------|------------------|
| **Nginx** | `expires`, `add_header Cache-Control ...` |
| **Apache** | `mod_expires`, `mod_headers` |
| **CDN (Cloudflare, Akamai)** | Политики кэширования и TTL |
| **Браузер** | Уважает заголовки сервера, может иметь свой local cache |
| **Серверное приложение** | Устанавливает заголовки кэша в ответе |

---

## Кратко по версиям HTTP

| Версия | Особенности |
|---------|--------------|
| **HTTP/1.0** | Одно соединение на запрос |
| **HTTP/1.1** | Keep-Alive, chunked encoding |
| **HTTP/2** | Мультиплексирование, бинарный формат |
| **HTTP/3 (QUIC)** | Работает поверх UDP, быстрее при потере пакетов |


- **OSI** — 7 уровней, HTTP на 7-м.
- **HTTP** — текстовый протокол запросов/ответов.
- **HTTPS** — тот же HTTP, но с шифрованием TLS.
- **Ограничения** задаются на уровне сервера.
- **Кэширование** управляется заголовками (`Cache-Control`, `ETag`, `Expires`).
- **HTTP/2 и HTTP/3** ускоряют передачу за счёт оптимизаций соединений