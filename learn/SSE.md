# Server-Sent Events (SSE)

Server-Sent Events (SSE) — технология, позволяющая серверу отправлять непрерывный поток данных клиенту через однонаправленное HTTP-соединение.

---

## Основные характеристики SSE

- **Односторонняя связь:** данные идут только от сервера к клиенту.
- **Использует HTTP/1.1:** работает поверх стандартного протокола HTTP.
- **Формат данных:** передача данных происходит в формате `text/event-stream`.
- **Автоматическое переподключение:** клиент автоматически восстанавливает соединение при разрыве.
- **Простота использования:** легко реализуется на стороне клиента и сервера.
- **Поддержка:** большинство современных браузеров (кроме IE и некоторых старых версий).

---

## Как работает SSE?

1. Клиент (браузер) открывает HTTP-запрос к серверу с заголовком `Accept: text/event-stream`.
2. Сервер отвечает с заголовками, указывающими, что это `text/event-stream`.
3. Сервер отправляет данные в формате событий — текстовые блоки с определённой структурой.
4. Клиент слушает эти события через JavaScript API `EventSource`.
5. При обрыве соединения браузер автоматически пытается переподключиться.

---

## Формат сообщений SSE

Сообщения состоят из строк, начинающихся с ключевых слов:

- `event:` — имя события (опционально).
- `data:` — данные события (могут быть несколько строк).
- `id:` — уникальный идентификатор события (для восстановления).
- `retry:` — время в миллисекундах для ожидания переподключения.

Пример сообщения:

```text
    "id": 1234,
    event: userUpdate,
    data: {"name": "Alice", "status": "online"},
```


Каждое сообщение завершается пустой строкой (`\n\n`).

---

## Пример: Клиентская сторона (JavaScript)

```js
const source = new EventSource('/events');

source.onopen = () => {
  console.log('Соединение открыто');
};

source.onmessage = (event) => {
  console.log('Новое сообщение:', event.data);
};

source.addEventListener('userUpdate', (event) => {
  const user = JSON.parse(event.data);
  console.log('Обновление пользователя:', user);
});

source.onerror = (err) => {
  console.error('Ошибка SSE:', err);
};
```

## Преимущества SSE

- Легко использовать и реализовать.
- Хорошо работает через HTTP и поддерживает прокси, балансировщики нагрузки.
- Автоматически восстанавливает соединение.
- Меньше накладных расходов, чем WebSocket, если нужна только серверная отправка данных.
- Использует простую текстовую структуру.

---

## Ограничения SSE

- Односторонняя связь — клиент не может отправлять данные серверу через SSE (для этого нужен WebSocket или обычные HTTP-запросы).
- Не поддерживается в IE и некоторых устаревших браузерах.
- Может быть ограничено максимальное количество открытых соединений браузером (обычно 6-8).
- При очень большом количестве клиентов может быть нагрузка на сервер.

---

## SSE vs WebSocket

| Особенность               | SSE                               | WebSocket                         |
|--------------------------|----------------------------------|----------------------------------|
| Направление данных       | Сервер → Клиент (односторонняя)  | Двунаправленная (сервер и клиент)|
| Протокол                | HTTP/1.1 (text/event-stream)      | Свой протокол поверх TCP          |
| Простота реализации     | Очень прост в реализации          | Сложнее, требует управления состоянием|
| Поддержка браузерами    | Большинство современных браузеров | Большинство браузеров             |
| Автоматическое переподключение | Есть                        | Нет                              |
| Использование           | Идеален для новостей, уведомлений| Идеален для игр, чатов, интерактивных приложений|

---

## Когда использовать SSE?

- Для потоковых обновлений, например, новостей, уведомлений, обновлений статуса.
- Когда нужна простая серверная отправка данных без сложной двунаправленной коммуникации.
- Когда важно использовать стандартный HTTP и работать с прокси и балансировщиками.

## Альтернативы: Polling (опрос сервера)

Polling — это техника, при которой клиент периодически отправляет запросы к серверу, чтобы получить новые данные.

**Недостатки polling:**

- Постоянные запросы создают нагрузку на сервер и сеть.
- Высокая задержка между обновлениями, если интервал опроса большой.
- Неэффективно при малом количестве изменений данных.

**Преимущества SSE над polling:**

- Сервер сам отправляет обновления по мере их появления.
- Снижает сетевой трафик и нагрузку.
- Меньшая задержка при получении данных.
