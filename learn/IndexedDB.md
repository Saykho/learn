# IndexedDB

IndexedDB ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤ –±—Ä–∞—É–∑–µ—Ä –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –±–æ–ª—å—à–∏–µ –æ–±—ä—ë–º—ã –¥–∞–Ω–Ω—ã—Ö (–º–∞—Å—Å–∏–≤—ã –æ–±—ä–µ–∫—Ç–æ–≤, —Ñ–∞–π–ª–æ–≤, –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö) –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –Ω–∏–º–∏ —Å –ø–æ–º–æ—â—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ JavaScript API.

## –ó–∞—á–µ–º –Ω—É–∂–Ω–∞
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π/PWA)
- –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫, –∏—Å—Ç–æ—Ä–∏–∏, –º–∞—Å—Å–∏–≤–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤
- –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (—á–∞—Ç—ã, –∑–∞–º–µ—Ç–∫–∏ –∏ —Ç.–ø.)

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫)
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–æ–±—ä–µ–∫—Ç—ã, –∏–Ω–¥–µ–∫—Å—ã, –∑–∞–ø—Ä–æ—Å—ã –≤—ã–±–æ—Ä–∫–∏)
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö, —á–µ–º LocalStorage

## –û—Å–Ω–æ–≤–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è –æ—Ç LocalStorage
- LocalStorage –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –ø–æ –æ–±—ä—ë–º—É (~5MB, —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏)
- IndexedDB –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã, –∏–Ω–¥–µ–∫—Å—ã, –ø–æ–∏—Å–∫, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø

## –ú–∏–Ω–∏-–ø—Ä–∏–º–µ—Ä: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
```js
// –û—Ç–∫—Ä—ã–≤–∞–µ–º/—Å–æ–∑–¥–∞—ë–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö mydb —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º objects
const request = indexedDB.open('mydb', 1);
request.onupgradeneeded = event => {
  const db = event.target.result;
  db.createObjectStore('objects', { keyPath: 'id' });
};
// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç
request.onsuccess = event => {
  const db = event.target.result;
  const tx = db.transaction('objects', 'readwrite');
  tx.objectStore('objects').put({id: 1, name: 'Test'});
};
// –ü–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç
request.onsuccess = event => {
  const db = event.target.result;
  const tx = db.transaction('objects', 'readonly');
  const store = tx.objectStore('objects');
  const getReq = store.get(1);
  getReq.onsuccess = () => console.log(getReq.result);
};
```

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
- PWA/SPA –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω-–¥–∞–Ω–Ω—ã—Ö
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ API-–æ—Ç–≤–µ—Ç–æ–≤
- –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [MDN IndexedDB](https://developer.mozilla.org/ru/docs/Web/API/IndexedDB_API)

---

## –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å POST-–∑–∞–ø—Ä–æ—Å—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ñ—Ñ–ª–∞–π–Ω

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–∑–¥–∞—ë—Ç –∑–∞–º–µ—Ç–∫—É, —Å–æ–æ–±—â–µ–Ω–∏–µ, –∑–∞–∫–∞–∑), –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –¥–≤—É—Ö —Ä–µ–∂–∏–º–∞—Ö:

### üü¢ –û–Ω–ª–∞–π–Ω
–ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –µ—Å—Ç—å ‚Äî –≤—Å—ë –ø—Ä–æ—Å—Ç–æ:

1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º fetch-–∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä (POST, PUT, PATCH –∏–ª–∏ DELETE);
2. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º/–æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ IndexedDB, —á—Ç–æ–±—ã –±–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–∞ –±—ã–ª–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π.

**–ü—Ä–∏–º–µ—Ä:**
```js
async function saveUserOnline(user) {
  const res = await fetch('/api/users', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(user),
  });
  const saved = await res.json();

  // —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É
  const db = await openDB('mydb', 1);
  const tx = db.transaction('users', 'readwrite');
  tx.objectStore('users').put(saved);
  await tx.done;
}
```

### üî¥ –û—Ñ—Ñ–ª–∞–π–Ω
–ï—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ—Ç ‚Äî –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ–ª—å–∑—è. –ü–æ—ç—Ç–æ–º—É –¥–∞–Ω–Ω—ã–µ —Å–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ IndexedDB –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, `pendingRequests`.

**–ü—Ä–∏–º–µ—Ä:**
```js
async function saveUserOffline(user) {
  const db = await openDB('mydb', 1, {
    upgrade(db) {
      if (!db.objectStoreNames.contains('pendingRequests')) {
        db.createObjectStore('pendingRequests', { autoIncrement: true });
      }
    },
  });

  const tx = db.transaction('pendingRequests', 'readwrite');
  tx.store.add({
    url: '/api/users',
    method: 'POST',
    body: user,
    timestamp: Date.now(),
  });
  await tx.done;
}
```

### üåê –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ —Å–µ—Ç–∏
–ö–æ–≥–¥–∞ —Å–µ—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–Ω–æ–≤–∞ –æ–Ω–ª–∞–π–Ω), –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ `pendingRequests` –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∏—Ö –Ω–∞—Å—Ç–æ—è—â–∏–º–∏ fetch-–∑–∞–ø—Ä–æ—Å–∞–º–∏:

```js
async function syncPendingRequests() {
  const db = await openDB('mydb', 1);
  const tx = db.transaction('pendingRequests', 'readwrite');
  const all = await tx.store.getAll();

  for (const req of all) {
    try {
      await fetch(req.url, {
        method: req.method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(req.body),
      });
      // –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω ‚Äî —É–¥–∞–ª—è–µ–º –µ–≥–æ –∏–∑ –æ—á–µ—Ä–µ–¥–∏
      tx.store.delete(req.id);
    } catch (err) {
      console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å', err);
    }
  }
  await tx.done;
}

// —Å–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ online
window.addEventListener('online', syncPendingRequests);
```

#### ‚öôÔ∏è –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç
| –ü–æ–≤–µ–¥–µ–Ω–∏–µ                  | –†–µ–∑—É–ª—å—Ç–∞—Ç                                                      |
|---------------------------|----------------------------------------------------------------|
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ñ–ª–∞–π–Ω       | –î–µ–π—Å—Ç–≤–∏—è (POST, PUT, DELETE) –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ IndexedDB          |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–Ω–æ–≤–∞ –æ–Ω–ª–∞–π–Ω | –û—á–µ—Ä–µ–¥—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä                    |
| –°–µ—Ä–≤–µ—Ä –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –∏–∑–º–µ–Ω–µ–Ω–∏—è | –û—á–µ—Ä–µ–¥—å –æ—á–∏—â–∞–µ—Ç—Å—è, IndexedDB —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è               |

---

üí° **–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ**

–î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –æ—Ñ—Ñ–ª–∞–π–Ω-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —á–∞—Å—Ç–æ –ø–æ–¥–∫–ª—é—á–∞—é—Ç:
- Service Worker —Å —Ñ–æ–Ω–æ–≤—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏ (Background Sync API)
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏: Workbox, Dexie.js (—É –Ω–µ–≥–æ –µ—Å—Ç—å dexie-syncable)

### üìò –ò—Ç–æ–≥–æ–≤—ã–π —Å–æ–≤–µ—Ç:
–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ —Å–µ—Ç–∏, –¥–µ–ª–∞–π –¥–≤–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:
- `data` ‚Äî –¥–ª—è –∫–µ—à–∞ —Ä–µ–∞–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `pendingRequests` ‚Äî –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ –¥–µ–π—Å—Ç–≤–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
